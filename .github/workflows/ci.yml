name: CI
on:
  push:
  pull_request:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo (JS SDK)
        uses: actions/checkout@v4

      - name: Setup Node 22
        uses: actions/setup-node@v4
        with:
          node-version: '22.x'
          cache: 'npm'

      - name: Install deps
        run: npm ci

      - name: Unit tests (if any)
        run: npm test --if-present

      - name: Checkout receipt-spec (for fixtures)
        uses: actions/checkout@v4
        with:
          repository: ai-trust-layer/receipt-spec
          path: receipt-spec

      - name: CLI check — schema-only PASS
        run: |
          node bin/receipt-verify \
            verify receipt-spec/proof-gallery/ok-1.json \
            --schema receipt-spec/docs/receipt.schema.json \
            --schema-only | grep -q '"pass": true'

      - name: CLI check — tampered FAIL
        run: |
          node bin/receipt-verify \
            verify receipt-spec/proof-gallery/tampered-1.json \
            --schema receipt-spec/docs/receipt.schema.json \
            | grep -q '"pass": false'
